<!-- C -->
# Railsアップグレード、UIリニューアルを通じてのレガシーコード改善への道のり

*テストのないコードはレガシーコードだ*

Railsアップグレードの話は割愛(前回のrailsdm参照)

SPA化
- RailsはAPI化
- FrontendはVue系かつwebpackは使わない

工夫した点
- 設計プロセスを第一に考える
  - フレームワークの完全な理解
  - 理解した上で

サーバサイド側

改善前
- APIドキュメントあるけどメンテされていない
- テストが少ない
- 新UIに適していないため使えない
- v1は使わない

方針
- blueprintでドキュメントを書く
- v2で作る
- テストを書く

工夫したこと
- 汎用性の高い処理は共通化・明文化
- テスト方針を明文化
- ドキュメントは成功・失敗を全パターン書く
- ドキュメント・テストを先に書く(テスト駆動開発)
- APIのエラーメッセージ
  - エラーコドとローカライズしたメッセージを返す

苦労したこと
- v1への配慮
- 不正データ対応
  - 仕様と合致しないデータ(すでにDBにある)

循環複雑度?
- 10以下だとバグが入りにくい(らしい)

まだある課題
- v1の管理をどうするか
- ロジックの置き場所、クラス分割の判断基準?
- テスト実行に時間がかかる

まとめると...
- テストがあればコードの状態が把握できる
- 変化に強くなる(検証しながらコードを書くことができる)

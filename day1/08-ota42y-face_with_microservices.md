<!-- C -->
# 我々はマイクロサービスとどう向き合うべきか

やるやらないに関わらずマイクロサービスを知る必要がある
5年間マイクロサービスをやっている
- FiNCでは初期からマイクロサービス

事業の拡大に伴ってマイクロ全体が大きくなる
- めちゃめちゃモノリスになってしまった

会社のフェーズ的な理由でリファクタリングより機能開発優先になる
同じアプリ開発部門でも切り分ける
- マイクロサービスは組織パターン

マイクロサービス化によって
- 日々の開発速度は上がる
- プログラミング以外も嬉しい
  - サービスなの変更に対する影響範囲が小さくなる
  - 専用チームでPDCAを回せる

マイクロサービスが増えすぎると...
- 徐々に辛くなる

1. セキュリティ対応が手薄になる
モノリシックなシステムと比べると
- アップデートは困難であるが、目が多くなるため把握できない状態は避けられる
- でも対応はマイクロの方が楽

モノリシック
- 作業が大変
- 漏れにくい
マイクロ
- 作業は楽
- 確認漏れが起こりやすい

FiNCの対策 漏れを減らす
- チーム横断的に動く集まりを作る
- gemのバージョンを見られるアプリ
- 週2hの割れ窓を直す時間

2. ドメイン(要素としてのドメイン)が成長して変わる
- 別のコミュニティでのランキング機能
- マイクロサービスごとに音楽性が違うので、理解して作るのは大変
- ドメインも切りにくい

モジュール化する必要がないものを切り出しすぎた

ただこれを避けるのは難しい
- マイクロ化しない選択肢はなかった

どうするか
- マイクロの統合
  - モノリスとなるため、マイクロ化したということが無駄になる
  - このまま作り続けるのは負債となってしまう

他にも...
- データの整合性(トランザクション)
- インフラ
- チーム連携
- サービスをまたぐと...

課題のまとめ
- マイクロに限った問題ではない
  - が、マイクロにしたことにより何倍にも膨れ上がる場合がある
- FiNCでは人数が足りていなかった
- 長期的なコストは見えない
- 独立して動くよさが、全体の複雑さを把握しにくくしている

どうすれば良いか
- 社内SaaSくらいの規模で作るのが理想
  - 選任チーム?
  - ドメインを切るだけではうまくいかないこともある

ラッパーマイクロサービス
- 裏にもノリシックを置いて新機能だけを分割
- レスポンスは遅く...

寄生マイクロサービス
- 開発しやすい場所の一部にモジュールを切って作る

エクソダスサービス
- 新機能を実装するための新たなモノリシック
  - 既存のものには手を加えない

マイクロサービスとRails
- 小中規模に留めるのが良い
- 最速で駆け抜けるには良い
- しかしRailsは密結合になりがち
  - 疎結合の綺麗な設計より、密結合になりがち

マイクロサービスは過渡期
- CI/CDほど成熟していない
- まだまだパワーが必要
  - インフラ・サービス連携など
- AWS, GCPのServiceMesh
- Envoy + Istio
- ballerina(マイクロサービスを前提とした言語)

DockerやAWSが生まれマイクロサービスが手軽に
- 中規模ぐらいの組織でも行けるようになった
- FaaSが当たり前の世界がくるかも?

まとめ
- マイクロサービスは麻薬
  - 不必要に複雑なマイクロ化をしてしまう
  - 長期的なコストは見えにくい
- Railsでマイクロをするにはまだ知見が足りない
